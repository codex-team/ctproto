<title>
  ðŸ’– CTProto Client Example
</title>

<script type="module" src="client.ts"></script>
Open the Console to check Client's work.
<br>

<br>
And you can test file uploading.
<br>

<input type="file" id="file">
<button id="upload">Upload</button>

<script type="module">
  import { uploadFile } from './send-file';

  const sendFile = (file, fileName) => {
    uploadFile(file, fileName);
  }

  /**
   * Convert data from arrayBuffer to Buffer
   *
   * @param ab - arrayBuffer data
   *
   * @return {Buffer} Converted Buffer data
   */
  function arrayBufferToBufferCycle(ab) {
    let buffer = new Buffer(ab.byteLength);
    let view = new Uint8Array(ab);
    for (let i = 0; i < buffer.length; ++i) {
      buffer[i] = view[i];
    }
    return buffer;
  }

    /**
     * Get elements for uploading files
     */
    const file = document.getElementById('file');
    const upload = document.getElementById('upload');

    /**
     * Creat onClick event for file uploading
     */
    upload.addEventListener('click', () => {

      let fileReader = new FileReader();
      fileReader.readAsArrayBuffer(file.files[0]);


      fileReader.onload = (event) => {
        let arrayBufferData = event.target.result;
        let buf = arrayBufferToBufferCycle(arrayBufferData)
        sendFile(buf, file.files[0].name);
  }
  });
</script>
